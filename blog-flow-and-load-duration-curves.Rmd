---
output: html_document
bibliography: FB-uncertainties.bibtex
link-citations: true
csl: nature.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
tutblog <- read.csv("birgand_tutblogs.csv", encoding = "UTF-8")
selection<-tutblog[tutblog$name=="Blog: Indices and exponents in R graphs",]
```
`r paste0("# ",selection$name)`
`r paste0("### *by ",selection$authors,"*")`
`r paste0("*started ",selection$date," and updated ",format(Sys.Date(), '%Y-%m-%d'),"*")`

<br/>

### Keywords
```{r echo=FALSE, results="asis",comment=FALSE} 
cat("*",gsub(";","\n * ",selection$keywords))
```
<br/><br/>

## Flow and Load duration curves

Lately, we have been researching and developing techniques of analyzing continuous water quality and hydrology data in order to explain hydrological and biogeochemical processes controlling stream chemistry in watersheds.  One of the techniques in which we have applied to an entire year of water quality and hydrology data is a method that assesses how relatively reactive nutrient/sediment loading is to flow and the relative flashiness of a watershed.  This method, referred to as load and flow duration curves, determines the percentages of the total load or Mass (Mk%) and volume of Water (Wk%) that occur in a percentage of the total sampling time, termed probability of occurrence.  

Mk% and Wk% duration curves can be plotted as a function of the probability of occurrence, which provides an interesting way of demonstrating how loading relates to flow and varies among water quality constituents.  This method can also be applied to individual storm events to assess if there is a first flush response.  We processed all data using R code and provide a sample dataset and code such that all of you may give this method a try!

Calculating and Plotting Flow Duration Curves

First, instantaneous flow rates in the dataset are ranked in descending order.





The cumulative discharge is then calculated by integrating the area under the Q Sorted curve at each data point. 




The cumulative discharge calculated at each instantaneous flow rate can be calculated as a percentage of the total discharge yielding Vk% values corresponding to the kth cumulative probability and the time elapsed at each point can be calculated as a percentage of the total time.  This works because even though flow rates are rearranged, the same amount of data points exist within the dataset with the same time increment occurring between each value. Vk% values can then be plotted as a function of the percentage of the total time.  This is what is referred to as Flow Duration Curves.  This provides a way of demonstrating of how relatively flashy the watershed may be either relatively to other watersheds or to previous years.  

The flashiness of a watershed refers to how rapidly flow is altered as a result of storm events/varying conditions.  More frequent spikes in flow in response to precipitation events, in which flow increases and decreases more greatly and rapidly, are typically indicative of watersheds with predominant portions of streamflow being influenced by surface runoff, a quicker responding contributor of water to streamflow.   

This method allows us to see the percentage of the total discharge that occurs in a fraction of the total time with the lowest probabilities of occurrence corresponding with the highest flow rates associated with event flow.  Therefore, if one watershed produces a majority of the total discharge in 50% of the time versus a watershed that produces a majority of the total discharge in 80% of the time, that watershed may be considered relatively flashier because a greater portion of the total discharge occurs in association with higher flow rates.  In other words, streamflow would be considered more reactive to event water because the event hydrograph rises and recedes more quickly than the other watershed.  This quick rise and recession allows for most flow to occur in a smaller percentage of the time versus the watershed that has a much wider event hydrograph spanning across a greater range of instantaneous flow values over a greater period of time. Visually, this method can provide a relative comparison of the flashiness of multiple watersheds.  In the example above, the shape of the curve in the first watershed would have a greater slope towards the lower percentages/probabilities of occurrence and the curve for the second watershed would be somewhat flatter. 

Calculating and Plotting Load Duration Curves

This part is similar to calculating Vk% except instantaneous flux is calculated (instantaneous flow rate * instantaneous concentration) and ranked in descending order instead.

Instantaneous flux = QC




The cumulative load is then calculated by integrating the area under the QCsort curve at each data point.   




   
Once again, the cumulative load calculated at each instantaneous flux value can be calculated as a percentage of the total load yielding Mk% values and the time elapsed at each point can be calculated as a percentage of the total time.  Mk% and Vk% values can be plotted as functions of the probability of occurrence and multiple Mk% curves for various water quality components can be plotted simultaneously for comparison of loading as a function of probability of occurrence.  For example, 50% of the nitrate load may be exported in 25% of the time whereas 50% of the ammonium load may be exported in only 5% of the time.  The interaction of flow and concentrations could be examined further to explain differences among loading and flashiness of concentrations with event flow.



With the above plot, we see that large changes in Mk% and Vk% occur near the lower probabilities of occurrence.  This demonstrates how crucial continuous water quality data is to understanding loading in watersheds because a large portion of the load can occur within a very small portion of time. We also see that it becomes slightly difficult to examine differences in the curves towards both ends of the x-axis.  Therefore, it is helpful to use the qnorm function in R to zoom in on the very low and high probabilities of occurrence, or on the tails of the normal distribution curve.  Check out the plot below and try the code yourselves! Thanks for reading!



